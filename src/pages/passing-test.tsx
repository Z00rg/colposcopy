import { UiFooter } from "@/shared/ui/ui-footer";
import { UiScrollImg } from "@/shared/ui/ui-scroll-img";
import { UiTextArea } from "@/shared/ui/ui-textarea";
import { useEffect, useMemo, useState } from "react";
import { UiProgressBar } from "@/shared/ui/ui-progress-bar";
import clsx from "clsx";
import { useRouter } from "next/router";
import { ROUTES } from "@/shared/constants/routes";
import { UiCheckBox } from "@/shared/ui/ui-checkbox";
import { UiSpinner } from "@/shared/ui/ui-spinner";

export function PassingTestPage() {
  // ------------------------------------------------------------------
  // –°–û–°–¢–û–Ø–ù–ò–ï
  // ------------------------------------------------------------------

  // –ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
  const [currentTaskIndex, setCurrentTaskIndex] = useState(0);

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ: –•—Ä–∞–Ω–∏–ª–∏—â–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  // –°—Ç—Ä—É–∫—Ç—É—Ä–∞: { [taskId]: { [questionIndex]: number[] } }
  const [selectedAnswers, setSelectedAnswers] = useState<
    Record<number, Record<number, number[]>>
  >({});

  // –•—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–æ—É—Ç–∏–Ω–≥–æ–º Next.js
  const router = useRouter();

  // ------------------------------------------------------------------
  // –û–ë–†–ê–ë–û–¢–ö–ê URL-–ü–ê–†–ê–ú–ï–¢–†–û–í –ò –õ–û–ì–ò–ö–ê –†–ï–î–ò–†–ï–ö–¢–ê
  // ------------------------------------------------------------------

  // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä testIds –∏–∑ URL
  const { testIds } = router.query;

  // useMemo: –ü–∞—Ä—Å–∏–Ω–≥ ID –ø–∞—Ç–æ–ª–æ–≥–∏–π –∏–∑ —Å—Ç—Ä–æ–∫–∏ testIds –≤ –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª.
  const selectedPathologyIds: number[] = useMemo(() => {
    let ids: number[] = [];
    if (typeof testIds === "string" && testIds.length > 0) {
      ids = testIds
        .split(",")
        .map((id) => Number(id))
        .filter((id) => !isNaN(id) && id > 0);
    }
    return ids;
  }, [testIds]); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ query –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ testIds

  // useEffect: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤, –µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã ID.
  useEffect(() => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ router.isReady –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã
    if (router.isReady && selectedPathologyIds.length === 0) {
      router.push(ROUTES.TEST);
    }
  }, [router.isReady, selectedPathologyIds.length, router.push, router]);

  // ------------------------------------------------------------------
  // üß© –î–ê–ù–ù–´–ï –ó–ê–î–ê–ù–ò–ô (–ó–ê–ì–õ–£–®–ö–ê)
  // ------------------------------------------------------------------

  // tasks –¥–∞–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏
  const tasks = {
    items: [
      {
        id: 1,
        imageSrcs: ["/test.jpg", "/test.jpg", "/test.jpg", "/test.jpg"],
        pathologyText: `–ö–∞—Ä—Ç–∏–Ω–∫–∞ 1: –ó–æ–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (3–¢) 1–≥–æ —Ç–∏–ø–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
          –≤—Å–µ–π –ø–ª–æ—â–∞–¥–∏ —Å—Ç—ã–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ –ø–ª–æ—Å–∫–æ–≥–æ —ç–ø–∏—Ç–µ–ª–∏—è –∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–æ–≥–æ
          —ç–ø–∏—Ç–µ–ª–∏—è, –≤–∫–ª—é—á–∞—è –µ–≥–æ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–π –¥–ª—è —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Äî
          –≥—Ä–∞–Ω–∏—Ü—É –º–µ—Ç–∞–ø–ª–∞–∑–∏–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—É—é –Ω–∞ —ç–∫—Ç–æ—Ü–µ—Ä–≤–∏–∫—Å–µ.`,
        testsQuestions: [
          {
            question: "–ü–ï–ï–†–í–´–ô –ü–¢–ê–õ–ê–ì–û–ò–Ø –ü–µ—Ä–≤–∏—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä",
            typeQuestion: 0,
            instructions: "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
            ],
          },
          {
            question: "–ì—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ú–ü–≠ –∏ –¶–≠",
            typeQuestion: 1,
            instructions:
              "–û—Ü–µ–Ω–∏—Ç–µ –≤–∏–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç–ø–∏—Ç–µ–ª–∏—è–º–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ",
              "–ù–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è",
            ],
          },
        ],
      },
      {
        id: 2,
        imageSrcs: ["/test.jpg", "/test.jpg", "/test.jpg", "/test.jpg"],
        pathologyText: `–ö–∞—Ä—Ç–∏–Ω–∫–∞ 1: –ó–æ–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (3–¢) 1–≥–æ —Ç–∏–ø–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
          –≤—Å–µ–π –ø–ª–æ—â–∞–¥–∏ —Å—Ç—ã–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ –ø–ª–æ—Å–∫–æ–≥–æ —ç–ø–∏—Ç–µ–ª–∏—è –∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–æ–≥–æ
          —ç–ø–∏—Ç–µ–ª–∏—è, –≤–∫–ª—é—á–∞—è –µ–≥–æ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–π –¥–ª—è —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Äî
          –≥—Ä–∞–Ω–∏—Ü—É –º–µ—Ç–∞–ø–ª–∞–∑–∏–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—É—é –Ω–∞ —ç–∫—Ç–æ—Ü–µ—Ä–≤–∏–∫—Å–µ.`,
        testsQuestions: [
          {
            question: "–≠–¢–û –û–¢ –í–¢–û–†–û–ì–û –í–û–ü–†–û–°–ê –ü–µ—Ä–≤–∏—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä",
            typeQuestion: 0,
            instructions: "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
            ],
          },
          {
            question: "–ì—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ú–ü–≠ –∏ –¶–≠",
            typeQuestion: 1,
            instructions:
              "–û—Ü–µ–Ω–∏—Ç–µ –≤–∏–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç–ø–∏—Ç–µ–ª–∏—è–º–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ",
              "–ù–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è",
            ],
          },
        ],
      },
      {
        id: 3,
        imageSrcs: ["/test.jpg", "/test.jpg", "/test.jpg", "/test.jpg"],
        pathologyText: `–ö–∞—Ä—Ç–∏–Ω–∫–∞ 1: –ó–æ–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (3–¢) 1–≥–æ —Ç–∏–ø–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
          –≤—Å–µ–π –ø–ª–æ—â–∞–¥–∏ —Å—Ç—ã–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ –ø–ª–æ—Å–∫–æ–≥–æ —ç–ø–∏—Ç–µ–ª–∏—è –∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–æ–≥–æ
          —ç–ø–∏—Ç–µ–ª–∏—è, –≤–∫–ª—é—á–∞—è –µ–≥–æ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–π –¥–ª—è —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Äî
          –≥—Ä–∞–Ω–∏—Ü—É –º–µ—Ç–∞–ø–ª–∞–∑–∏–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—É—é –Ω–∞ —ç–∫—Ç–æ—Ü–µ—Ä–≤–∏–∫—Å–µ.`,
        testsQuestions: [
          {
            question: "–≠–¢–û –û–¢ –¢–†–ï–¢–¨–ï–ì–û –í–û–ü–†–û–°–ê –ü–µ—Ä–≤–∏—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä",
            typeQuestion: 0,
            instructions: "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
            ],
          },
          {
            question: "–ì—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ú–ü–≠ –∏ –¶–≠",
            typeQuestion: 1,
            instructions:
              "–û—Ü–µ–Ω–∏—Ç–µ –≤–∏–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç–ø–∏—Ç–µ–ª–∏—è–º–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ",
              "–ù–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è",
            ],
          },
        ],
      },
      {
        id: 4,
        imageSrcs: ["/test.jpg", "/test.jpg", "/test.jpg", "/test.jpg"],
        pathologyText: `–ö–∞—Ä—Ç–∏–Ω–∫–∞ 1: –ó–æ–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (3–¢) 1–≥–æ —Ç–∏–ø–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
          –≤—Å–µ–π –ø–ª–æ—â–∞–¥–∏ —Å—Ç—ã–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ –ø–ª–æ—Å–∫–æ–≥–æ —ç–ø–∏—Ç–µ–ª–∏—è –∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–æ–≥–æ
          —ç–ø–∏—Ç–µ–ª–∏—è, –≤–∫–ª—é—á–∞—è –µ–≥–æ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–π –¥–ª—è —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Äî
          –≥—Ä–∞–Ω–∏—Ü—É –º–µ—Ç–∞–ø–ª–∞–∑–∏–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—É—é –Ω–∞ —ç–∫—Ç–æ—Ü–µ—Ä–≤–∏–∫—Å–µ.`,
        testsQuestions: [
          {
            question: " –ß–ï–¢–í–ï–†–¢–´–ô –ü–ê–¢–ê–õ–û–ì–ò–Ø –ü–µ—Ä–≤–∏—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä",
            typeQuestion: 0,
            instructions: "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
            ],
          },
          {
            question: "–ì—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ú–ü–≠ –∏ –¶–≠",
            typeQuestion: 1,
            instructions:
              "–û—Ü–µ–Ω–∏—Ç–µ –≤–∏–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç–ø–∏—Ç–µ–ª–∏—è–º–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ",
              "–ù–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è",
            ],
          },
        ],
      },
      {
        id: 5,
        imageSrcs: ["/test.jpg", "/test.jpg", "/test.jpg", "/test.jpg"],
        pathologyText: `–ö–∞—Ä—Ç–∏–Ω–∫–∞ 1: –ó–æ–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (3–¢) 1–≥–æ —Ç–∏–ø–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
          –≤—Å–µ–π –ø–ª–æ—â–∞–¥–∏ —Å—Ç—ã–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ –ø–ª–æ—Å–∫–æ–≥–æ —ç–ø–∏—Ç–µ–ª–∏—è –∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–æ–≥–æ
          —ç–ø–∏—Ç–µ–ª–∏—è, –≤–∫–ª—é—á–∞—è –µ–≥–æ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–π –¥–ª—è —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Äî
          –≥—Ä–∞–Ω–∏—Ü—É –º–µ—Ç–∞–ø–ª–∞–∑–∏–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—É—é –Ω–∞ —ç–∫—Ç–æ—Ü–µ—Ä–≤–∏–∫—Å–µ.`,
        testsQuestions: [
          {
            question: "–≠–¢–û –û–¢ –ü–Ø–¢–´–ô –ü–µ—Ä–≤–∏—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä",
            typeQuestion: 0,
            instructions: "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
            ],
          },
          {
            question: "–ì—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ú–ü–≠ –∏ –¶–≠",
            typeQuestion: 1,
            instructions:
              "–û—Ü–µ–Ω–∏—Ç–µ –≤–∏–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç–ø–∏—Ç–µ–ª–∏—è–º–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ",
              "–ù–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è",
            ],
          },
        ],
      },
      {
        id: 6,
        imageSrcs: ["/test.jpg", "/test.jpg", "/test.jpg", "/test.jpg"],
        pathologyText: `–ö–∞—Ä—Ç–∏–Ω–∫–∞ 1: –ó–æ–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (3–¢) 1–≥–æ —Ç–∏–ø–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
          –≤—Å–µ–π –ø–ª–æ—â–∞–¥–∏ —Å—Ç—ã–∫–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ –ø–ª–æ—Å–∫–æ–≥–æ —ç–ø–∏—Ç–µ–ª–∏—è –∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏—á–µ—Å–∫–æ–≥–æ
          —ç–ø–∏—Ç–µ–ª–∏—è, –≤–∫–ª—é—á–∞—è –µ–≥–æ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–π –¥–ª—è —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Äî
          –≥—Ä–∞–Ω–∏—Ü—É –º–µ—Ç–∞–ø–ª–∞–∑–∏–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—É—é –Ω–∞ —ç–∫—Ç–æ—Ü–µ—Ä–≤–∏–∫—Å–µ.`,
        testsQuestions: [
          {
            question: "–®–ï–°–¢–û–ô –ü–ê–¢–ê–õ–û–ì–ò–Ø –ü–µ—Ä–≤–∏—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä",
            typeQuestion: 0,
            instructions: "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
              "–ö–æ–ª—å–ø–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è ",
            ],
          },
          {
            question: "–ì—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ú–ü–≠ –∏ –¶–≠",
            typeQuestion: 1,
            instructions:
              "–û—Ü–µ–Ω–∏—Ç–µ –≤–∏–¥–∏–º–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç–ø–∏—Ç–µ–ª–∏—è–º–∏. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç.",
            answers: [
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
              "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–∞—Å—Ç–∏—á–Ω–æ",
              "–ù–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è",
            ],
          },
        ],
      },
    ],
  };

  // ------------------------------------------------------------------
  // –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –ü–†–û–í–ï–†–ö–ê –ó–ê–î–ê–ù–ò–ô
  // ------------------------------------------------------------------

  // useMemo: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π –ø–æ ID, –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –∏–∑ URL.
  const filteredTasks = useMemo(() => {
    return {
      ...tasks,
      items: tasks.items.filter((task) =>
        selectedPathologyIds.includes(task.id)
      ),
    };
  }, [tasks, selectedPathologyIds]);

  // useEffect: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç, –µ—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π –ø—É—Å—Ç.
  useEffect(() => {
    if (router.isReady && filteredTasks.items.length === 0) {
      router.push(ROUTES.TEST);
    }
  }, [router.isReady, filteredTasks.items.length, router]);

  // ------------------------------------------------------------------
  // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò
  // ------------------------------------------------------------------

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è
  const handleTaskChange = (index: number) => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
    if (index < 0 || index >= tasks.items.length) return;
    setCurrentTaskIndex(index);
  };

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–ø—ã—Ç–∫–∏
  const handleFinishAttempt = () => {
    console.log("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ —Å –æ—Ç–≤–µ—Ç–∞–º–∏:", selectedAnswers);
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç
    // router.push(ROUTES.HOME);
  };

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
  const getSelectedFor = (taskId: number, questionIndex: number): number[] =>
    selectedAnswers[taskId]?.[questionIndex] ?? [];

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (—á–µ–∫–±–æ–∫—Å–∞)
  const toggleAnswer = (
    taskId: number,
    questionIndex: number,
    answerIndex: number,
    typeQuestion: number // 0 - –æ–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä, 1 - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
  ) => {
    setSelectedAnswers((prev) => {
      const taskAnswers = { ...(prev[taskId] || {}) };
      const current = taskAnswers[questionIndex]
        ? [...taskAnswers[questionIndex]]
        : [];

      if (typeQuestion === 0) {
        // –û–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å
        taskAnswers[questionIndex] = [answerIndex];
      } else {
        // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä: –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –∏–Ω–¥–µ–∫—Å
        if (current.includes(answerIndex)) {
          taskAnswers[questionIndex] = current.filter((i) => i !== answerIndex);
        } else {
          taskAnswers[questionIndex] = [...current, answerIndex];
        }
      }

      return { ...prev, [taskId]: taskAnswers };
    });
  };

  return (
    <div className="flex flex-col items-center min-h-screen lg:min-h-[667px]">
      <div className="flex flex-col justify-center items-center gap-3 flex-1 mb-4 px-5 mt-5">
        {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */}
        <UiProgressBar
          numOfCurrentTask={currentTaskIndex} // –¢–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å –∑–∞–¥–∞–Ω–∏—è
          tasks={filteredTasks} // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
        />

        {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–æ–≥–æ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è) */}
        <UiScrollImg img={filteredTasks.items[currentTaskIndex].imageSrcs} />

        {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ë–ª–æ–∫–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ */}
        <UiTextArea className="mt-5 gap-3 w-full text-[13px] items-start">
          <div className="font-bold text-[15px]">
            –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞–Ω–∏—è:
          </div>

          {/* –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è */}
          {filteredTasks.items[currentTaskIndex].testsQuestions.map(
            (item: any, questionIndex: number) => {
              const taskId = filteredTasks.items[currentTaskIndex].id;
              // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
              const selectedForThis = getSelectedFor(taskId, questionIndex);

              return (
                <div
                  className="flex flex-col gap-2 w-full text-[13px] pb-5 border-b-2 border-[#BDBDBD]"
                  key={`${taskId}-${questionIndex}`}
                >
                  {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–æ–ø—Ä–æ—Å–∞ */}
                  <div className="flex w-full">
                    <span>
                      <span className="font-bold">
                        –ó–∞–¥–∞–Ω–∏–µ ‚Ññ{questionIndex + 1}:
                      </span>{" "}
                      {item.question}
                    </span>
                  </div>

                  {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫ –≤–æ–ø—Ä–æ—Å—É */}
                  <div className="flex w-full">
                    <span>
                      <span className="font-bold">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</span>{" "}
                      {item.instructions}
                    </span>
                  </div>

                  {/* –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –æ—Ç–≤–µ—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ */}
                  {item.answers.map((answer: string, answerIndex: number) => {
                    const isChecked = selectedForThis.includes(answerIndex);
                    return (
                      <div
                        className="flex gap-2"
                        key={`${taskId}-${questionIndex}-${answerIndex}`}
                      >
                        {/* –ù–æ–º–µ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞ */}
                        <div className="flex justify-center">
                          {answerIndex + 1}.
                        </div>
                        {/* –¢–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞ */}
                        <div className="flex justify-center break-words whitespace-normal">
                          {answer}
                        </div>
                        {/* –ß–µ–∫–±–æ–∫—Å/–†–∞–¥–∏–æ–±–∞—Ç—Ç–æ–Ω –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞ */}
                        <div className="ml-auto w-6 h-6 flex justify-center items-center">
                          <UiCheckBox // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UiCheckBox, –Ω–æ –ª–æ–≥–∏–∫–∞ –≤ `toggleAnswer` –∏–º–∏—Ç–∏—Ä—É–µ—Ç –∏ –æ–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä
                            checked={isChecked}
                            onChange={() =>
                              toggleAnswer(
                                taskId,
                                questionIndex,
                                answerIndex,
                                item.typeQuestion
                              )
                            }
                            id={`chk-${taskId}-${questionIndex}-${answerIndex}`}
                          />
                        </div>
                      </div>
                    );
                  })}
                </div>
              );
            }
          )}
        </UiTextArea>

        {/* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–ù–∞–∑–∞–¥ / –î–∞–ª–µ–µ / –ó–∞–∫–æ–Ω—á–∏—Ç—å) */}
        <div className="flex w-full">
          {/* –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" */}
          <button
            className={clsx(
              // –°–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–∏–Ω–¥–µ–∫—Å 0)
              { hidden: currentTaskIndex === 0 },
              "mr-auto text-[#2E76AA] hover:text-[#26628A] text-[20px] font-normal cursor-pointer"
            )}
            onClick={() => handleTaskChange(currentTaskIndex - 1)}
            disabled={currentTaskIndex === 0}
          >
            –ù–∞–∑–∞–¥
          </button>

          {/* –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ" */}
          <button
            className={clsx(
              // –°–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
              { hidden: currentTaskIndex === filteredTasks.items.length - 1 },
              "ml-auto text-[#2E76AA] hover:text-[#26628A] text-[20px] font-normal cursor-pointer"
            )}
            onClick={() => handleTaskChange(currentTaskIndex + 1)}
            disabled={currentTaskIndex === filteredTasks.items.length - 1}
          >
            –î–∞–ª–µ–µ
          </button>

          {/* –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫–æ–Ω—á–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É" */}
          <button
            className={clsx(
              // –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∑–∞–¥–∞–Ω–∏–∏
              { hidden: currentTaskIndex !== filteredTasks.items.length - 1 },
              "ml-auto text-[#2E76AA] hover:text-[#26628A] text-[20px] font-normal cursor-pointer"
            )}
            onClick={handleFinishAttempt}
            disabled={currentTaskIndex !== filteredTasks.items.length - 1}
          >
            –ó–∞–∫–æ–Ω—á–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
          </button>
        </div>

        {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –§—É—Ç–µ—Ä–∞ —Å –∞–∫—Ç–∏–≤–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º "test" */}
        <UiFooter activeStatus="test" />
      </div>
    </div>
  );
}



